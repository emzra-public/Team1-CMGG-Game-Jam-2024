[gd_scene load_steps=6 format=3 uid="uid://ck5buu2hf4kbd"]

[ext_resource type="Script" path="res://DialogSystem/dialog_player.gd" id="1_h26oi"]
[ext_resource type="Texture2D" uid="uid://mfvbexo7hn8b" path="res://Assets/dialogue-box-sample.png" id="1_wc0hk"]

[sub_resource type="LabelSettings" id="LabelSettings_voq5b"]
font_size = 64

[sub_resource type="GDScript" id="GDScript_va2ws"]
script/source = "extends PanelContainer

signal SELECTED(index)

@onready var choices_list = $\"MarginContainer/Choices\"
@onready var choices_prefab = $\"MarginContainer/Choices/Button\"

var choices:Array[String]:
	set(value):
		choices = value
		initButtons()

# Called when the node enters the scene tree for the first time.
func _ready():
	choices_list.get_child(0).pressed.connect(onChoice.bind(0))

func initButtons():
	while choices_list.get_child_count() > 1:
		var button = choices_list.get_child(choices_list.get_child_count() - 1)
		choices_list.remove_child(button)
		button.queue_free()
	
	for i in range(choices.size()):
		if (i == 0):
			choices_list.get_child(0).text = choices[i]
		else:
			choices_list.add_child(choices_prefab.duplicate())
			choices_list.get_child(i).text = choices[i]
			choices_list.get_child(i).pressed.connect(onChoice.bind(i))

func onChoice(choice_index):
	visible = false
	SELECTED.emit(choice_index)
	if choice_index == 2:  # Assuming option 2 increases karma
		PlayerKarma.increase_karma()
	elif choice_index == 3:  # Assuming option 3 increases stole
		PlayerKarma.increase_stole()
	
"

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_vvq4y"]

[node name="DialogPlayer" type="CanvasLayer"]
process_mode = 3
script = ExtResource("1_h26oi")

[node name="Background" type="TextureRect" parent="."]
offset_left = -22.0
offset_top = -42.0
offset_right = 1129.0
offset_bottom = 821.25
texture = ExtResource("1_wc0hk")
expand_mode = 5
stretch_mode = 4

[node name="TextLabel" type="Label" parent="."]
offset_left = 147.0
offset_top = 405.0
offset_right = 1034.0
offset_bottom = 594.0
label_settings = SubResource("LabelSettings_voq5b")
autowrap_mode = 3

[node name="ChoicesDialog" type="PanelContainer" parent="."]
offset_left = 149.0
offset_top = 403.0
offset_right = 1030.0
offset_bottom = 594.0
script = SubResource("GDScript_va2ws")

[node name="MarginContainer" type="MarginContainer" parent="ChoicesDialog"]
layout_mode = 2

[node name="Choices" type="VBoxContainer" parent="ChoicesDialog/MarginContainer"]
layout_mode = 2

[node name="Button" type="Button" parent="ChoicesDialog/MarginContainer/Choices"]
layout_mode = 2
theme_override_styles/hover = SubResource("StyleBoxFlat_vvq4y")
